<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>FF7 Variable Converter</title>
		<style>
			<!--
			body {
				text-align: center;
				background-color: #99a;
				color: #334;
				font-family: "Arial", sans-serif;
			}
			
			#form {
				text-align: center;
				margin: auto;
			}

			#form th, #form td {
				border: 1px #334 solid;
				padding: 25px;
				background-color: #aab;
			}
			
			#scarlet, #landscaper { width: 75px; }

			.makou { width: 50px; }
		//-->
		</style>

		<script>
		function getVariables(source) {
			var saveMapStart = parseInt('DC08DC', 16);
			var saveMapStartPSX = parseInt('9D288', 16);
			var wmOffset = parseInt('BA4', 16); 
			var tempBank = parseInt('CC14D0', 16);
			var bankCount = 5;

			if (source == 1) { //makou
				var bank = parseInt(document.getElementById('makou-bank').value);
				var pos = parseInt(document.getElementById('makou-pos').value);
				var addressPC = "unknown";
				var addressPSX = "unknown";
				var addressWM = "unknown";

				if (bank == 5 || bank == 6) {
					addressPC = (tempBank + pos).toString(16).toUpperCase();
				}
				else if (bank > 7 && bank < 11) {
					addressPC = "invalid";
					addressPSX = "invalid";
				}
				else {
					var offset = bank;
					if (bank == 7) {offset = bankCount - 1;}
					else {
						if (offset > 7) {offset -= 6;}
						if (offset % 2 != 0) {offset++;}
						offset = (offset / 2) - 1;
					}

					var addressPC = (saveMapStart + (offset * 256) + pos).toString(16).toUpperCase();
					var addressPSX = (saveMapStartPSX + (offset * 256) + pos).toString(16).toUpperCase();
					var addressWM = (wmOffset + (offset * 256) + pos).toString(16).toUpperCase();
				}
				document.getElementById('memory-address-pc').value = addressPC;
				document.getElementById('memory-address-psx').value = addressPSX;
				document.getElementById('landscaper').value = addressWM;
				if (bank > 2) {
					document.getElementById('scarlet').value = "none";
				}
				else {
					document.getElementById('scarlet').value = pos.toString(16).padStart(2,'0').toUpperCase();
				}
			}
			
			else if (source == 2) { //scarlet
				var pos = parseInt(document.getElementById('scarlet').value, 16);
				if (isNaN(pos)) {window.alert("Not a valid hex address.");}
				else {
					document.getElementById('makou-bank').value = 1;
					document.getElementById('makou-pos').value = pos;
					document.getElementById('memory-address-pc').value = (saveMapStart + pos).toString(16).toUpperCase();
					document.getElementById('memory-address-psx').value = (saveMapStartPSX + pos).toString(16).toUpperCase();
					document.getElementById('landscaper').value = (wmOffset + pos).toString(16).toUpperCase();
				}
			}
			
			else { //memory address
				var value = parseInt(document.getElementById('memory-address-pc').value, 16);
				var temp = tempBank;
				var saveMap = saveMapStart;
				
				if (source == 3) { //landscaper
					value = parseInt(document.getElementById('landscaper').value, 16);
					saveMap = wmOffset;
				}
				if (source == 5) { //psx
					value = parseInt(document.getElementById('memory-address-psx').value, 16);
					//temp = tempBankPSX;
					saveMap = saveMapStartPSX;
				}
				
				if (isNaN(value)) {window.alert("Not a valid hex address.");}
				
				else if (value >= temp && value < temp + 256) {
					document.getElementById('makou-bank').value = 5;
					document.getElementById('makou-pos').value = (value - temp);
				}
				
				else if (value >= saveMap && value < saveMap + (256 * bankCount)) {
					var pos = value - saveMap;
					
					document.getElementById('memory-address-pc').value = (saveMapStart + pos).toString(16).toUpperCase();
					document.getElementById('memory-address-psx').value = (saveMapStartPSX + pos).toString(16).toUpperCase();
					document.getElementById('landscaper').value = (wmOffset + pos).toString(16).toUpperCase();
					
					var offset = 1;
					while (pos > 255) {
						pos -= 256;
						offset++;
					}
					var bank = (offset * 2) - 1;
					if (offset == bankCount) {bank = 15;}
					else if (offset > 2) {bank += 6;}
					
					document.getElementById('makou-bank').value = bank;
					document.getElementById('makou-pos').value = pos;
					
					if (bank == 1) {
						document.getElementById('scarlet').value = pos.toString(16).padStart(2,'0').toUpperCase();
					}
					else {
						document.getElementById('scarlet').value = "none";
					}
				}
				
				else {window.alert("Address is out of range.");}
			}
		}
		</script>
	</head>
	<body>
		<h1>FF7 Variable Converter</h1>
		<table id="form">
			<tr>
				<th>Makou Reactor</th>
				<td>Var <input id="makou-bank" class="makou" type="number" min=1 max=15> <input id="makou-pos" class="makou" type="number" min=0 max=255></td>
				<td><input type="button" value="Calculate from this" onclick="getVariables(1);"></td>
			</tr>
			
			<tr>
				<th>Scarlet</th>
				<td>GlobalVar: <input id="scarlet" maxLength=2></td>
				<td><input type="button" value="Calculate from this" onclick="getVariables(2);"></td>
			</tr>

			<tr>
				<th>Landscaper</th>
				<td>Savemap[<input id="landscaper" maxLength=3>]</td>
				<td><input type="button" value="Calculate from this" onclick="getVariables(3);"></td>

			<tr>
				<th>Memory address (PC)</th>
				<td><input id="memory-address-pc" maxLength=6></td>
				<td><input type="button" value="Calculate from this" onclick="getVariables(4);"></td>
			</tr>

			<tr>
				<th>Memory address (PSX)</th>
				<td><input id="memory-address-psx" maxLength=6></td>
				<td><input type="button" value="Calculate from this" onclick="getVariables(5);"></td>
			</tr>
		</table>
	</body>
</html>